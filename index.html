<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CareJoint Diagnostic Quiz</title>
    <style>
        :root { 
            --primary: #007bff; 
            --success: #28a745; 
            --danger: #dc3545; 
            --light: #f8f9fa; 
            --dark: #343a40; 
            --warning: #ffc107; 
            --bg: #e9ecef;
        }

        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center;
            height: 100vh; /* Fixed height for app-like feel */
            padding: 15px;
            box-sizing: border-box;
            overflow: hidden; /* Prevent body scroll */
        }

        .container { 
            background: white; 
            padding: 1.5rem; 
            border-radius: 16px; 
            width: 100%; 
            max-width: 500px; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
            display: flex;
            flex-direction: column;
            height: 90vh; /* Fixed container height */
            max-height: 800px;
            position: relative;
            overflow: hidden; 
        }

        /* --- Header & Stats --- */
        h1 { color: var(--primary); margin: 0 0 5px 0; font-size: 1.6rem; flex-shrink: 0; }
        .subtitle { color: #6c757d; margin-bottom: 15px; font-size: 0.9rem; flex-shrink: 0; }

        .stats-bar { 
            display: flex; 
            justify-content: space-between; 
            font-weight: 700; 
            color: #555; 
            margin-bottom: 10px; 
            font-size: 0.9rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            flex-shrink: 0;
        }

        /* --- Timer --- */
        .timer-track { 
            height: 6px; 
            background: #eee; 
            border-radius: 3px; 
            overflow: hidden; 
            margin-bottom: 15px; 
            flex-shrink: 0;
        }
        .timer-fill { 
            height: 100%; 
            background: var(--warning); 
            width: 100%; 
            transition: width 1s linear; 
        }

        /* --- Question Box --- */
        .question-box {
            min-height: 90px; 
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            line-height: 1.35;
            padding: 0 5px;
            flex-shrink: 0;
        }

        /* --- Scrollable Areas --- */
        #options, #mistakes {
            overflow-y: auto;
            flex-grow: 1; /* Takes all available space */
            padding-right: 5px;
            -webkit-overflow-scrolling: touch; 
            overscroll-behavior: contain; 
        }

        /* Mistake List Specifics */
        #mistakes {
            text-align: left;
            border: 1px solid #eee;
            padding: 10px;
            margin: 10px 0; /* Margin around list, not button */
            border-radius: 10px;
            background: #fcfcfc;
            font-size: 0.9rem;
        }

        /* --- Buttons --- */
        .option-btn { 
            background: white; 
            border: 2px solid #e9ecef; 
            padding: 14px 10px; 
            border-radius: 12px; 
            width: 100%; 
            margin-bottom: 10px; 
            cursor: pointer; 
            font-size: 1rem; 
            transition: all 0.2s ease; 
            font-weight: 500; 
            color: #444;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .option-btn:hover:not(:disabled) { 
            border-color: var(--primary); 
            background: #f8faff; 
            transform: translateY(-1px);
        }

        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: var(--danger); color: white; border-color: var(--danger); }
        
        .main-btn { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 14px; 
            border-radius: 50px; 
            font-size: 1.1rem; 
            font-weight: bold;
            cursor: pointer; 
            width: 100%; 
            margin-top: auto; /* Pushes to bottom if flex container */
            box-shadow: 0 4px 10px rgba(0,123,255,0.3);
            transition: transform 0.1s;
            flex-shrink: 0; /* Never shrink */
        }
        .main-btn:active { transform: scale(0.96); }

        /* --- Inputs --- */
        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }
        .input-label {
            font-size: 0.9rem;
            font-weight: bold;
            color: #555;
            margin-left: 5px;
            margin-bottom: 5px;
            display: block;
        }
        select { 
            width: 100%; 
            padding: 12px; 
            border-radius: 10px; 
            border: 2px solid #eee; 
            font-size: 1rem; 
            background-color: #fff;
            cursor: pointer;
        }

        /* --- Screens --- */
        #quiz-screen, #end-screen { 
            display: none; 
            height: 100%; 
            flex-direction: column; 
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }

    </style>
</head>
<body>

<div class="container">
    
    <div id="start-screen">
        <h1>Carejoint Quiz</h1>
        <p class="subtitle">Price, Significance & Package Master</p>
        
        <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
            <div class="input-group">
                <span class="input-label">Select Topic:</span>
                <select id="cat-filter">
                    <option value="All">All Sections</option>
                    <option value="Packages">ðŸ“¦ Full Body Package (New)</option>
                    <option value="Pathology">Pathology</option>
                    <option value="X-Ray">X-Ray</option>
                    <option value="Ultrasound">Ultrasound</option>
                    <option value="Special Studies">Special Studies</option>
                </select>
            </div>

            <div class="input-group">
                <span class="input-label">Number of Questions:</span>
                <select id="limit-filter">
                    <option value="10">10 Questions</option>
                    <option value="25" selected>25 Questions</option>
                    <option value="50">50 Questions</option>
                    <option value="9999">All Questions</option>
                </select>
            </div>
        </div>
        
        <button class="main-btn" onclick="startQuiz()">Unleash the hell</button>
    </div>

    <div id="quiz-screen">
        <div class="stats-bar">
            <span>Score: <span id="score">0</span></span>
            <span>Q: <span id="q-num">1</span> / <span id="q-total">0</span></span>
        </div>
        
        <div class="timer-track"><div class="timer-fill" id="timer"></div></div>
        
        <div class="question-box" id="question">Loading...</div>
        
        <div id="options"></div>
        
        <div id="feedback" style="height:20px; font-weight:bold; margin-top:5px; font-size:0.9rem; flex-shrink:0;"></div>
        
        <button id="next-btn" class="main-btn" style="display:none;" onclick="nextQuestion()">Next Question</button>
    </div>

    <div id="end-screen">
        <h1>Congratulations for surviving!</h1>
        <p style="font-size:1.3rem; color:#444; margin: 10px 0; flex-shrink:0;">
            Final Score: <strong style="color:var(--primary)" id="final-score">0</strong>
        </p>
        
        <div id="mistakes"></div>
        
        <button class="main-btn" onclick="location.reload()">Restart Quiz</button>
    </div>

</div>

<script>
// --- MAIN DATABASE ---
const db = [
    // X-RAY
    {c:"X-Ray",t:"Chest PA",p:500,r:"Checks lungs/heart; for cough, pneumonia, TB"},
    {c:"X-Ray",t:"C Spine AP/LAT",p:900,r:"Neck vertebrae; for neck pain, trauma, spondylosis"},
    {c:"X-Ray",t:"L Spine AP/LAT",p:900,r:"Lower back vertebrae; for slip disc, sciatica"},
    {c:"X-Ray",t:"Dorsal Spine AP/LAT",p:900,r:"Mid-back; for posture issues, trauma"},
    {c:"X-Ray",t:"Hand AP/LAT",p:900,r:"Orthopedic; fractures, arthritis in hand"},
    {c:"X-Ray",t:"Elbow AP/LAT",p:900,r:"Orthopedic; fractures, dislocation in elbow"},
    {c:"X-Ray",t:"Wrist AP/LAT",p:900,r:"Orthopedic; fractures, arthritis in wrist"},
    {c:"X-Ray",t:"Foot AP/LAT",p:900,r:"Orthopedic; fractures in foot"},
    {c:"X-Ray",t:"Ankle AP/LAT",p:900,r:"Orthopedic; sprains, fractures in ankle"},
    {c:"X-Ray",t:"Knee AP/LAT",p:900,r:"Orthopedic; arthritis, gaps in knee joint"},
    {c:"X-Ray",t:"Leg AP/LAT",p:900,r:"Orthopedic; fractures in tibia/fibula"},
    {c:"X-Ray",t:"Skull AP/LAT",p:900,r:"Head trauma, bony abnormalities"},
    {c:"X-Ray",t:"PNS (Sinus)",p:900,r:"Sinusitis, headache, blockage"},
    {c:"X-Ray",t:"IVP",p:3000,r:"Kidney dye test; stones, urinary blockage"},

    // SPECIAL STUDIES
    {c:"Special Studies",t:"FNAC",p:4500,r:"Biopsy of lumps (breast/thyroid) for cancer"},
    {c:"Special Studies",t:"Barium Swallow",p:2000,r:"Esophagus X-ray; difficulty swallowing"},
    {c:"Special Studies",t:"Barium Meal",p:3500,r:"Stomach/Intestine X-ray; ulcers, digestive issues"},
    {c:"Special Studies",t:"HSG",p:4500,r:"Uterus/Tube check; infertility, blocked tubes"},

    // ULTRASOUND
    {c:"Ultrasound",t:"Early OBS",p:1800,r:"Early pregnancy; heartbeat & viability"},
    {c:"Ultrasound",t:"Upper Abdomen",p:1800,r:"Liver, Gallbladder, Pancreas check"},
    {c:"Ultrasound",t:"Pelvis",p:1800,r:"Uterus, Ovaries, Bladder check"},
    {c:"Ultrasound",t:"KUB",p:1800,r:"Kidney, Ureter, Bladder; stones/pain"},
    {c:"Ultrasound",t:"Abdomen + Pelvis",p:1800,r:"Full belly scan; general pain check"},
    {c:"Ultrasound",t:"NT Scan",p:2800,r:"3-4 Month pregnancy; Down Syndrome screen"},
    {c:"Ultrasound",t:"Anomaly Scan",p:3500,r:"5th Month; detailed baby organ check"},
    {c:"Ultrasound",t:"Obstetric Doppler",p:3500,r:"Blood flow to baby; high-risk pregnancy"},
    {c:"Ultrasound",t:"Renal Doppler",p:3500,r:"Kidney blood flow; hypertension check"},
    {c:"Ultrasound",t:"Venous Doppler",p:3500,r:"Leg veins; DVT (clots) check"},
    {c:"Ultrasound",t:"Sonomamography",p:2500,r:"Breast ultrasound; lumps/cancer check"},
    {c:"Ultrasound",t:"USG Thyroid",p:2500,r:"Neck ultrasound; thyroid lumps"},
    {c:"Ultrasound",t:"USG Scrotum",p:2500,r:"Testicle scan; pain or swelling"},
    {c:"Ultrasound",t:"Follicular Study",p:1500,r:"Tracking egg release (4 sessions)"},
    {c:"Ultrasound",t:"2D Echo",p:2500,r:"Heart scan; pumping function"},

    // PATHOLOGY
    {c:"Pathology",t:"CBC",p:250,r:"Basic blood profile; anemia, infection"},
    {c:"Pathology",t:"Blood Group",p:250,r:"ABO/Rh typing; surgery/donation"},
    {c:"Pathology",t:"ESR",p:100,r:"Inflammation marker; TB, autoimmune"},
    {c:"Pathology",t:"Sugar (Fasting)",p:100,r:"Diabetes screen (Empty stomach)"},
    {c:"Pathology",t:"Sugar (PP)",p:100,r:"Diabetes screen (After food)"},
    {c:"Pathology",t:"HbA1c",p:500,r:"3-month average sugar; Diabetes monitoring"},
    {c:"Pathology",t:"Creatinine",p:200,r:"Kidney function; filtration marker"},
    {c:"Pathology",t:"Urea",p:200,r:"Kidney waste product level"},
    {c:"Pathology",t:"Uric Acid",p:200,r:"Gout, joint pain, kidney stones"},
    {c:"Pathology",t:"Cholesterol",p:200,r:"Total fat in blood"},
    {c:"Pathology",t:"Lipid Profile",p:800,r:"Detailed heart risk (HDL/LDL/Triglycerides)"},
    {c:"Pathology",t:"SGOT",p:200,r:"Liver enzyme; general damage marker"},
    {c:"Pathology",t:"SGPT",p:200,r:"Liver enzyme; specific for liver health"},
    {c:"Pathology",t:"Bilirubin",p:200,r:"Jaundice check (Yellow eyes/skin)"},
    {c:"Pathology",t:"LFT",p:800,r:"Complete Liver panel"},
    {c:"Pathology",t:"T3 T4 TSH",p:600,r:"Complete Thyroid Profile"},
    {c:"Pathology",t:"Free TFT",p:1000,r:"Active thyroid hormone level"},
    {c:"Pathology",t:"Calcium",p:200,r:"Bone strength; deficiency causes pain"},
    {c:"Pathology",t:"Vit D3",p:1200,r:"Bone health; sun vitamin deficiency"},
    {c:"Pathology",t:"Vit B12",p:1000,r:"Nerve health; fatigue, tingling"},
    {c:"Pathology",t:"Iron Studies",p:700,r:"Detailed anemia check"},
    {c:"Pathology",t:"Ferritin",p:800,r:"Iron storage levels"},
    {c:"Pathology",t:"Electrolytes",p:600,r:"Sodium/Potassium; hydration & heart"},
    {c:"Pathology",t:"Amylase",p:500,r:"Pancreatitis check"},
    {c:"Pathology",t:"Lipase",p:500,r:"Pancreatitis check (Specific)"},
    {c:"Pathology",t:"Dengue NS1",p:600,r:"Early Dengue fever (Day 1-3)"},
    {c:"Pathology",t:"Dengue IgG/IgM",p:1200,r:"Late Dengue fever/Recovery"},
    {c:"Pathology",t:"Malaria MP",p:300,r:"Malaria check (Microscope)"},
    {c:"Pathology",t:"Malaria Antigen",p:700,r:"Malaria check (Rapid Kit)"},
    {c:"Pathology",t:"Widal",p:300,r:"Typhoid fever test"},
    {c:"Pathology",t:"Urine R/M",p:300,r:"UTI, kidney infection check"},
    {c:"Pathology",t:"Urine Culture",p:1800,r:"Bacteria identification for UTI antibiotics"},
    {c:"Pathology",t:"Stool R/M",p:250,r:"Worms, parasites, digestion check"},
    {c:"Pathology",t:"HIV",p:400,r:"AIDS virus screening"},
    {c:"Pathology",t:"HBsAg",p:800,r:"Hepatitis B screening"},
    {c:"Pathology",t:"HCV",p:1000,r:"Hepatitis C screening"},
    {c:"Pathology",t:"VDRL",p:300,r:"Syphilis screening"},
    {c:"Pathology",t:"Troponin I",p:1200,r:"Heart attack confirmation"},
    {c:"Pathology",t:"Troponin T",p:1800,r:"Heart attack confirmation"},
    {c:"Pathology",t:"B-HCG",p:600,r:"Pregnancy confirmation (Blood)"},
    {c:"Pathology",t:"FSH",p:500,r:"Fertility hormone (Follicle Stimulating)"},
    {c:"Pathology",t:"LH",p:500,r:"Fertility hormone (Luteinizing)"},
    {c:"Pathology",t:"Prolactin",p:500,r:"Milk hormone; irregular periods"},
    {c:"Pathology",t:"AMH",p:2200,r:"Ovarian reserve (Egg count)"},
    {c:"Pathology",t:"Semen Analysis",p:500,r:"Male fertility; sperm count"},
    {c:"Pathology",t:"Dual Marker",p:2800,r:"Down Syndrome risk (1st Trimester)"},
    {c:"Pathology",t:"Quadruple Marker",p:3000,r:"Down Syndrome risk (2nd Trimester)"},
    {c:"Pathology",t:"PT-INR",p:500,r:"Clotting time (Warfarin patients)"},
    {c:"Pathology",t:"APTT",p:600,r:"Clotting time (Heparin patients)"},
    {c:"Pathology",t:"RA Factor",p:500,r:"Rheumatoid Arthritis check"},
    {c:"Pathology",t:"Anti CCP",p:1400,r:"Early Arthritis check (Specific)"},
    {c:"Pathology",t:"Ana Profile",p:5500,r:"Autoimmune disease check (Lupus)"},
    {c:"ECG",t:"Electrocardiography",p:500,r:"Records heart rhythm; for chest pain"}
];

// --- PACKAGE SPECIAL QUESTIONS (EXPANDED) ---
const pkgQuestions = [
    {
        q: "What is the <b>Offer Price</b> of the Full Body Checkup?",
        a: "â‚¹1500/-",
        f: ["â‚¹4000/-", "â‚¹2500/-", "â‚¹1200/-"]
    },
    {
        q: "What is the <b>MRP</b> of the Full Body Checkup (without discount)?",
        a: "â‚¹4000/-",
        f: ["â‚¹1500/-", "â‚¹3000/-", "â‚¹5500/-"]
    },
    {
        q: "Which <b>Vitamins</b> are included in the Full Body Checkup?",
        a: "Vit B12 & Vit D3",
        f: ["Vit C & Vit A", "Vit D3 only", "No Vitamins included"]
    },
    {
        q: "Does the Full Body Checkup include <b>Ultrasound (USG)</b>?",
        a: "No",
        f: ["Yes, Whole Abdomen", "Yes, KUB only", "Yes, Pelvis only"]
    },
    {
        q: "Which cardiac test is included in the Full Body Checkup?",
        a: "ECG",
        f: ["2D Echo", "Troponin I", "Stress Test"]
    },
    {
        q: "Does the package include <b>HbA1c</b> (3-month sugar)?",
        a: "Yes, Glycosylated Hb",
        f: ["No, only Fasting Sugar", "No, only Urine Sugar", "No"]
    },
    {
        q: "Which specific Kidney Function (KFT) tests are included?",
        a: "Urea, Creatinine, BUN, Uric Acid",
        f: ["Creatinine only", "Urea & Electrolytes only", "None"]
    },
    {
        q: "Does the package include <b>Thyroid Profile</b>?",
        a: "Only TSH (Thyroid)",
        f: ["Yes, T3 T4 TSH", "No Thyroid tests", "Only T3 & T4"]
    },
    {
        q: "Is <b>Calcium</b> included in the Full Body Checkup?",
        a: "Yes",
        f: ["No", "Only if requested", "Only with Vitamin D3"]
    },
    {
        q: "Which Lipid Profile components are included?",
        a: "Cholesterol, Triglycerides, HDL, LDL, VLDL",
        f: ["Only Total Cholesterol", "Only HDL & LDL", "Cholesterol & Triglycerides only"]
    },
    {
        q: "Is <b>Urine R/M</b> included in the package?",
        a: "Yes",
        f: ["No", "Only Urine Culture", "Only Urine Sugar"]
    },
    {
        q: "Which Liver enzymes are tested in this package?",
        a: "SGOT (AST) & SGPT (ALT)",
        f: ["Only SGOT", "Only SGPT", "None"]
    },
    {
        q: "Is <b>Total Protein & Albumin</b> included?",
        a: "Yes, along with Globulin & A/G Ratio",
        f: ["No", "Only Total Protein", "Only Albumin"]
    },
    {
        q: "What is the full form of <b>LFT</b> mentioned in the package?",
        a: "Liver Function Test",
        f: ["Lung Function Test", "Lipid Function Test", "Liquid Filtration Test"]
    },
    {
        q: "Does the package include <b>Risk Factors</b> analysis?",
        a: "Yes",
        f: ["No", "Only if requested", "Only for heart patients"]
    },
    {
        q: "Is <b>BUN</b> (Blood Urea Nitrogen) included?",
        a: "Yes",
        f: ["No", "Only Urea", "Only Creatinine"]
    },
    {
        q: "Is <b>BSF / PP (Sugar)</b> included?",
        a: "Yes",
        f: ["No, only Random Sugar", "No, only HbA1c", "No"]
    },
    {
        q: "Does the package include <b>ESR</b>?",
        a: "Yes",
        f: ["No", "Only CBC", "Only Platelet Count"]
    },
    {
        q: "Is <b>S. Bilirubin</b> (Total, Direct, Indirect) included?",
        a: "Yes",
        f: ["No", "Only Total Bilirubin", "Only Direct Bilirubin"]
    },
    {
        q: "Does the package include <b>S. Alkaline Phosphatase</b>?",
        a: "Yes",
        f: ["No", "Only Acid Phosphatase", "Only if requested"]
    }
];

// --- GAME LOGIC ---
let state = { q:[], idx:0, score:0, mistakes:[] };
let timer;

function startQuiz() {
    let cat = document.getElementById('cat-filter').value;
    let limit = parseInt(document.getElementById('limit-filter').value);
    
    state.q = [];

    // 1. Add Regular Database Questions
    if (cat !== 'Packages') {
        let pool = cat === 'All' ? db : db.filter(x => x.c === cat);
        
        pool.forEach(item => {
            state.q.push({ 
                type: 'price', 
                txt: `What is the price of <br><span style='color:var(--primary)'>${item.t}</span>?`, 
                ans: `â‚¹${item.p}` 
            });
            
            if(item.r) {
                state.q.push({ 
                    type: 'reason', 
                    txt: `What is the significance of <br><span style='color:var(--primary)'>${item.t}</span>?`, 
                    ans: item.r 
                });
                state.q.push({ 
                    type: 'rev', 
                    txt: `Which test is used for:<br><i>"${item.r.substring(0, 50)}..."</i>?`, 
                    ans: item.t 
                });
            }
        });
    }

    // 2. Add Package Questions
    if (cat === 'All' || cat === 'Packages') {
        pkgQuestions.forEach(pq => {
            state.q.push({ type: 'pkg', txt: pq.q, ans: pq.a, f: pq.f });
        });
    }

    if(!state.q.length) return alert("No questions found.");
    
    // Shuffle
    state.q.sort(() => Math.random() - 0.5);
    
    // SLICE based on limit
    if (limit < state.q.length) {
        state.q = state.q.slice(0, limit);
    }
    
    // Reset State
    state.idx = 0; state.score = 0; state.mistakes = [];
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('end-screen').style.display = 'none';
    document.getElementById('quiz-screen').style.display = 'flex';
    document.getElementById('q-total').innerText = state.q.length;
    
    showQ();
}

function showQ() {
    if(state.idx >= state.q.length) return end();
    
    let q = state.q[state.idx];
    document.getElementById('q-num').innerText = state.idx + 1;
    document.getElementById('question').innerHTML = q.txt;
    document.getElementById('score').innerText = state.score;
    document.getElementById('feedback').innerHTML = '';
    document.getElementById('next-btn').style.display = 'none';

    // Options Logic
    let opts = new Set();
    opts.add(q.ans);

    if (q.type === 'pkg') {
        q.f.forEach(f => opts.add(f));
    } else {
        let max = 50;
        while(opts.size < 4 && max > 0) {
            let r = db[Math.floor(Math.random() * db.length)];
            if(q.type === 'price') opts.add(`â‚¹${r.p}`);
            else if(q.type === 'reason') opts.add(r.r || "General checkup");
            else opts.add(r.t);
            max--;
        }
        if(opts.size < 4) {
            if(q.type === 'price') opts.add("â‚¹1500").add("â‚¹5000");
            else opts.add("Routine Check").add("Viral Infection");
        }
    }

    let box = document.getElementById('options');
    box.innerHTML = '';
    
    Array.from(opts).sort(() => Math.random() - 0.5).forEach(o => {
        let btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.innerHTML = o;
        btn.onclick = () => check(btn, o, q);
        box.appendChild(btn);
    });

    startTimer();
}

function startTimer() {
    clearInterval(timer);
    let t = 20;
    let bar = document.getElementById('timer');
    bar.style.width = '100%';
    bar.style.backgroundColor = '#ffc107';

    timer = setInterval(() => {
        t--;
        bar.style.width = (t/15*100) + '%';
        if(t < 5) bar.style.backgroundColor = '#dc3545';
        if(t <= 0) { clearInterval(timer); check(null, null, state.q[state.idx]); }
    }, 1000);
}

function check(btn, sel, q) {
    clearInterval(timer);
    document.querySelectorAll('.option-btn').forEach(b => {
        b.disabled = true;
        if(b.innerHTML === q.ans) b.classList.add('correct');
    });

    if(sel === q.ans) {
        state.score++;
        document.getElementById('feedback').innerHTML = '<span style="color:green">Correct!</span>';
    } else {
        if(btn) btn.classList.add('wrong');
        document.getElementById('feedback').innerHTML = '<span style="color:red">Wrong!</span>';
        let txt = q.txt.replace(/<[^>]*>/g, '');
        state.mistakes.push(`<b>Q:</b> ${txt}<br><b>Ans:</b> ${q.ans}`);
    }
    document.getElementById('next-btn').style.display = 'block';
}

function nextQuestion() { state.idx++; showQ(); }

function end() {
    document.getElementById('quiz-screen').style.display = 'none';
    document.getElementById('end-screen').style.display = 'flex';
    document.getElementById('final-score').innerText = `${state.score} / ${state.q.length}`;
    
    let mBox = document.getElementById('mistakes');
    if(state.mistakes.length) {
        mBox.style.display = 'block';
        mBox.innerHTML = '<h3>Review Mistakes:</h3>' + state.mistakes.map(m => `<div style="border-bottom:1px solid #ddd; padding:10px 0;">${m}</div>`).join('');
    } else {
        mBox.style.display = 'none';
    }
}
</script>
</body>
</html>
